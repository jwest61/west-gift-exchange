<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>West Family Gift Exchange üéÅ</title>
<style>
  /* Unified font */
  * { font-family: 'Poppins', sans-serif; }
  body { background: #f9fafb; margin: 0; padding: 0; }
  h1 { color: #146c43; text-align: center; margin: 20px 0; }

  .container {
    display: flex;
    justify-content: flex-start;
    align-items: flex-start;
    gap: 40px;
    padding: 20px 40px 40px 40px;
  }

  /* Left Column: Pairings */
  .left-column { min-width: 240px; }
  .left-column h2 { color: #146c43; margin-bottom: 5px; }
  .pairings-table {
    width: 100%;
    border-collapse: collapse;
    background: #d1e7dd;
    border-radius: 8px;
    overflow: hidden;
    margin-bottom: 20px;
  }
  .pairings-table th, .pairings-table td {
    padding: 6px;
    border-bottom: 1px solid #146c43;
    text-align: left;
  }
  .pairings-table th { background: #146c43; color: white; }

  /* Right Column: Tabs & Content */
  .right-column { flex: 1; }
  .tabs { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 20px; }
  .tab {
    background: #d1e7dd;
    border: 2px solid #146c43;
    border-radius: 10px;
    padding: 8px 16px;
    cursor: pointer;
    font-weight: 600;
    white-space: nowrap;
  }
  .tab.active { background: #146c43; color: white; }

  .content {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    padding: 20px;
    text-align: left;
  }

  /* Gift input area */
  .gift-section h3 { margin-bottom: 10px; color: #146c43; }
  .gift-inputs {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 20px;
  }
  .gift-inputs input, .gift-inputs textarea {
    border: 1px solid #ccc;
    border-radius: 6px;
    padding: 8px;
    flex: 1;
  }
  .gift-inputs input[type="number"] { width: 80px; }
  .gift-inputs button { flex-shrink: 0; }

  button {
    background: #146c43;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 8px 14px;
    cursor: pointer;
    font-weight: 600;
  }
  button:hover { background: #0f5132; }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  th, td { padding: 8px; border-bottom: 1px solid #e9ecef; }
  a { color: #0d6efd; }
</style>
</head>
<body>

<h1>üéÑ West Family Gift Exchange üéÅ</h1>

<div class="container">
  <!-- LEFT: Pairings -->
  <div class="left-column">
    <h2>Adults</h2>
    <table class="pairings-table">
      <tr><th>Giver</th><th>Receiver</th></tr>
      <tr><td>Jon</td><td>Katie</td></tr>
      <tr><td>Dave</td><td>Jason</td></tr>
      <tr><td>Karen</td><td>Chelsea</td></tr>
      <tr><td>Jen</td><td>Stef</td></tr>
      <tr><td>Dan</td><td>Jon</td></tr>
      <tr><td>Jason</td><td>Dave</td></tr>
      <tr><td>Stef</td><td>Geoff</td></tr>
      <tr><td>Katie</td><td>Dan</td></tr>
      <tr><td>Chelsea</td><td>Jen</td></tr>
      <tr><td>Geoff</td><td>Karen</td></tr>
    </table>

    <h2>Kids</h2>
    <table class="pairings-table">
      <tr><th>Giver</th><th>Receiver</th></tr>
      <tr><td>Eddie</td><td>Gwen</td></tr>
      <tr><td>Gwen</td><td>Evie</td></tr>
      <tr><td>Evie</td><td>Claire</td></tr>
      <tr><td>Claire</td><td>Eddie</td></tr>
      <tr><td>Main</td><td>Theo</td></tr>
      <tr><td>Theo</td><td>Elora</td></tr>
      <tr><td>Elora</td><td>Main</td></tr>
      <tr><td>Eden</td><td>Nora</td></tr>
      <tr><td>Nora</td><td>Eden</td></tr>
    </table>
  </div>

  <!-- RIGHT: Tabs & Content -->
  <div class="right-column">
    <div class="tabs" id="tabs"></div>
    <div id="content" class="content"></div>
  </div>
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbwP_Tbu9_QuDMm6onR0fvri-byDwspixqDClvnTPU2NC1R7SE01pPlORnQoQWKczorsrg/exec"; // Replace with your Apps Script URL

const adults = ["Jon","Katie","Dave","Jason","Karen","Chelsea","Jen","Stef","Dan","Geoff"];
const kids = ["Eddie","Gwen","Evie","Claire","Main","Theo","Elora","Eden","Nora"];
const people = [...adults, ...kids];
let data = {};

async function loadData() {
  const res = await fetch(`${scriptURL}?t=${Date.now()}`);
  data = await res.json();
  renderTabs();
}

function renderTabs() {
  const tabContainer = document.getElementById("tabs");
  tabContainer.innerHTML = "";

  // Adults row
  adults.forEach(p => {
    const tab = document.createElement("div");
    tab.className = "tab";
    tab.textContent = p;
    tab.onclick = () => selectPerson(p);
    tabContainer.appendChild(tab);
  });

  // Spacer for new row
  const br = document.createElement("div");
  br.style.flexBasis = "100%";
  tabContainer.appendChild(br);

  // Kids row
  kids.forEach(p => {
    const tab = document.createElement("div");
    tab.className = "tab";
    tab.textContent = p;
    tab.onclick = () => selectPerson(p);
    tabContainer.appendChild(tab);
  });

  selectPerson(people[0]);
}

function selectPerson(person) {
  document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
  [...document.querySelectorAll(".tab")].find(t => t.textContent === person).classList.add("active");

  const c = document.getElementById("content");
  const pData = data[person] || { gifts: [], stocking: "" };

  c.innerHTML = `
    <div class="gift-section">
      <h3>Add Gift</h3>
      <div class="gift-inputs">
        <input id="giftName" placeholder="Gift name" />
        <input id="priority" placeholder="Priority" style="width:80px"/>
        <input id="price" type="number" placeholder="Price" style="width:80px"/>
        <input id="url" placeholder="URL" />
        <textarea id="notes" placeholder="Notes" rows="1"></textarea>
        <button onclick="addGift('${person}')">Add Gift</button>
      </div>

      <h3>Gifts for ${person}</h3>
      <table>
        <tr><th>Name</th><th>Priority</th><th>Price</th><th>Notes</th><th>Link</th><th></th></tr>
        ${pData.gifts.map(g => `
          <tr>
            <td>${g.name}</td>
            <td>${g.priority}</td>
            <td>${g.price}</td>
            <td>${g.notes}</td>
            <td>${g.url ? `<a href="${g.url}" target="_blank">Link</a>` : ""}</td>
            <td><button onclick="removeGift('${person}','${g.name}')">‚ùå</button></td>
          </tr>
        `).join("")}
      </table>

      <h3 style="margin-top:25px;">Stocking Idea</h3>
      <textarea id="stockingIdea" rows="3" style="width:100%;">${pData.stocking || ""}</textarea><br>
      <button onclick="saveStocking('${person}')">Save Stocking Idea</button>
    </div>
  `;
}

async function addGift(person) {
  const gift = {
    name: document.getElementById("giftName").value.trim(),
    priority: document.getElementById("priority").value.trim(),
    price: document.getElementById("price").value.trim(),
    url: document.getElementById("url").value.trim(),
    notes: document.getElementById("notes").value.trim()
  };
  if (!gift.name) return alert("Please enter a gift name");

  await fetch(scriptURL, {
    method: "POST",
    body: JSON.stringify({ action: "addGift", person, gift })
  });
  loadData();
}

async function removeGift(person, name) {
  await fetch(scriptURL, {
    method: "POST",
    body: JSON.stringify({ action: "removeGift", person, name })
  });
  loadData();
}

async function saveStocking(person) {
  const stocking = document.getElementById("stockingIdea").value.trim();
  await fetch(scriptURL, {
    method: "POST",
    body: JSON.stringify({ action: "saveStocking", person, stocking })
  });
  alert("Stocking idea saved!");
}

loadData();
</script>
</body>
</html>
