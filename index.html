<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ðŸŽ„ West Family Gift Exchange</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      display: flex;
      background-color: #f5f7f5;
      color: #333;
    }

    .left-column {
      width: 260px;
      background-color: #e8f5e9;
      padding: 20px;
      border-right: 2px solid #a5d6a7;
      text-align: center;
    }

    .tree {
      font-size: 40px;
      margin-bottom: 10px;
    }

    .group-title {
      font-weight: bold;
      color: #2e7d32;
      margin-top: 20px;
      margin-bottom: 8px;
      text-align: left;
    }

    .pair-table {
      width: 100%;
      border-collapse: collapse;
      background-color: #f0fdf4;
      border-radius: 8px;
      overflow: hidden;
    }

    .pair-table td {
      padding: 6px 8px;
      border-bottom: 1px solid #c8e6c9;
      text-align: left;
    }

    .content {
      flex: 1;
      padding: 20px;
    }

    .tabs {
      display: flex;
      flex-wrap: wrap;
      margin-bottom: 15px;
      gap: 5px;
      justify-content: center;
    }

    .tab {
      padding: 8px 14px;
      background-color: #c8e6c9;
      border-radius: 6px;
      cursor: pointer;
    }

    .tab.active {
      background-color: #81c784;
      color: white;
    }

    .tab-content {
      display: none;
      background-color: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 6px rgba(0,0,0,0.1);
    }

    .tab-content.active {
      display: block;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      border-bottom: 1px solid #ddd;
      padding: 6px;
      text-align: left;
    }

    th {
      background-color: #e8f5e9;
    }

    input, textarea {
      padding: 6px;
      box-sizing: border-box;
    }

    input {
      height: 30px;
    }

    textarea {
      width: 100%;
      height: 80px;
      resize: vertical;
      margin-top: 5px;
    }

    .gift-input-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 6px;
    }

    .gift-input-row input {
      flex: 1;
    }

    .gift-input-row button {
      flex-shrink: 0;
    }

    button {
      padding: 6px 10px;
      background-color: #66bb6a;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover {
      background-color: #57a05b;
    }

    h3 {
      color: #2e7d32;
    }
  </style>
</head>
<body>
  <div class="left-column">
    <div class="tree">ðŸŽ„</div>
    <h2>Gift Pairings</h2>

    <div class="group-title">Adults</div>
    <table class="pair-table">
      <tr><td>Jon â†’ Katie</td></tr>
      <tr><td>Dave â†’ Jason</td></tr>
      <tr><td>Karen â†’ Chelsea</td></tr>
      <tr><td>Jen â†’ Stef</td></tr>
      <tr><td>Dan â†’ Jon</td></tr>
      <tr><td>Jason â†’ Dave</td></tr>
      <tr><td>Stef â†’ Geoff</td></tr>
      <tr><td>Katie â†’ Dan</td></tr>
      <tr><td>Chelsea â†’ Jen</td></tr>
      <tr><td>Geoff â†’ Karen</td></tr>
    </table>

    <div class="group-title">Kids</div>
    <table class="pair-table">
      <tr><td>Eddie â†’ Gwen</td></tr>
      <tr><td>Gwen â†’ Evie</td></tr>
      <tr><td>Evie â†’ Claire</td></tr>
      <tr><td>Claire â†’ Eddie</td></tr>
      <tr><td>Main â†’ Theo</td></tr>
      <tr><td>Theo â†’ Elora</td></tr>
      <tr><td>Elora â†’ Main</td></tr>
      <tr><td>Eden â†’ Nora</td></tr>
      <tr><td>Nora â†’ Eden</td></tr>
    </table>
  </div>

  <div class="content">
    <div class="tabs">
      <div class="tab" data-person="Jon">Jon</div>
      <div class="tab" data-person="Dave">Dave</div>
      <div class="tab" data-person="Karen">Karen</div>
      <div class="tab" data-person="Jen">Jen</div>
      <div class="tab" data-person="Dan">Dan</div>
      <div class="tab" data-person="Jason">Jason</div>
      <div class="tab" data-person="Stef">Stef</div>
      <div class="tab" data-person="Katie">Katie</div>
      <div class="tab" data-person="Chelsea">Chelsea</div>
      <div class="tab" data-person="Geoff">Geoff</div>
    </div>
    <div class="tabs">
      <div class="tab" data-person="Eddie">Eddie</div>
      <div class="tab" data-person="Gwen">Gwen</div>
      <div class="tab" data-person="Evie">Evie</div>
      <div class="tab" data-person="Claire">Claire</div>
      <div class="tab" data-person="Main">Main</div>
      <div class="tab" data-person="Theo">Theo</div>
      <div class="tab" data-person="Elora">Elora</div>
      <div class="tab" data-person="Eden">Eden</div>
      <div class="tab" data-person="Nora">Nora</div>
    </div>

    <div id="tab-contents"></div>
  </div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbxp7B-f21quwbC-UcqnJTdb1xDzePMHd-GoWWGyMjBpt5ua8XMPswBh-jLSKywkz5gA1g/exec";
    const people = [
      "Jon","Dave","Karen","Jen","Dan","Jason","Stef","Katie","Chelsea","Geoff",
      "Eddie","Gwen","Evie","Claire","Main","Theo","Elora","Eden","Nora"
    ];

    const tabContents = document.getElementById("tab-contents");

    // Build each person's tab content
    people.forEach(person => {
      const div = document.createElement("div");
      div.classList.add("tab-content");
      div.id = `content-${person}`;
      div.innerHTML = `
        <h3>${person}'s Gift List</h3>
        <div class="gift-input-row">
          <input id="giftName-${person}" placeholder="Gift name" />
          <input id="giftPriority-${person}" placeholder="Priority" style="width:80px;" />
          <input id="giftPrice-${person}" placeholder="Price" style="width:80px;" />
          <input id="giftURL-${person}" placeholder="Product URL (optional)" />
          <input id="giftNotes-${person}" placeholder="Notes (optional)" style="flex:2;" />
          <button onclick="addGift('${person}')">Add Gift</button>
        </div>

        <table id="giftTable-${person}">
          <tr><th>Gift</th><th>Priority</th><th>Price</th><th>Link</th><th>Notes</th><th>Remove</th></tr>
        </table>

        <h3>Stocking Ideas</h3>
        <textarea id="stocking-${person}" placeholder="Add stocking ideas..."></textarea>
        <button onclick="saveStocking('${person}')">Save Stocking Ideas</button>
      `;
      tabContents.appendChild(div);
    });

    // Tab switching
    document.querySelectorAll(".tab").forEach(tab => {
      tab.addEventListener("click", () => {
        document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
        document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));
        tab.classList.add("active");
        document.getElementById(`content-${tab.dataset.person}`).classList.add("active");
      });
    });

    async function addGift(person) {
      const name = document.getElementById(`giftName-${person}`).value.trim();
      const priority = document.getElementById(`giftPriority-${person}`).value.trim();
      const price = document.getElementById(`giftPrice-${person}`).value.trim();
      const url = document.getElementById(`giftURL-${person}`).value.trim();
      const notes = document.getElementById(`giftNotes-${person}`).value.trim();
      if (!name) return alert("Please enter a gift name.");

      const gift = { person, name, priority, price, url, notes };

      await fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify({ action: "addGift", gift, person }),
      });

      renderGift(person, gift);

      document.getElementById(`giftName-${person}`).value = "";
      document.getElementById(`giftPriority-${person}`).value = "";
      document.getElementById(`giftPrice-${person}`).value = "";
      document.getElementById(`giftURL-${person}`).value = "";
      document.getElementById(`giftNotes-${person}`).value = "";
    }

    function renderGift(person, gift) {
      const table = document.getElementById(`giftTable-${person}`);
      const row = document.createElement("tr");
      const fullURL = gift.url
        ? (gift.url.startsWith("http") ? gift.url : `https://${gift.url}`)
        : "";
      const linkHTML = fullURL ? `<a href="${fullURL}" target="_blank">View</a>` : "";

      row.innerHTML = `
        <td>${gift.name}</td>
        <td>${gift.priority}</td>
        <td>${gift.price}</td>
        <td>${linkHTML}</td>
        <td>${gift.notes || ""}</td>
        <td><button onclick="removeGift('${person}', '${gift.name}', this)">Remove</button></td>
      `;
      table.appendChild(row);
    }

    async function removeGift(person, giftName, btn) {
      btn.closest("tr").remove();
      await fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify({ action: "removeGift", person, name: giftName }),
      });
    }

    async function saveStocking(person) {
      const stocking = document.getElementById(`stocking-${person}`).value;
      await fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify({ action: "saveStocking", person, stocking }),
      });
      alert("Stocking ideas saved!");
    }

    async function loadData() {
      const res = await fetch(`${scriptURL}?action=getData`);
      const data = await res.json();
      Object.keys(data).forEach(person => {
        if (data[person].gifts) {
          data[person].gifts.forEach(g => renderGift(person, g));
        }
        if (data[person].stocking && document.getElementById(`stocking-${person}`)) {
          document.getElementById(`stocking-${person}`).value = data[person].stocking;
        }
      });
    }

    loadData();
  </script>
</body>
</html>
