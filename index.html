<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>West Family Gift Exchange üéÑ</title>
<style>
  body { font-family: Arial, sans-serif; background: #f5fff5; color: #333; margin: 0; padding: 20px; }
  h1 { color: #2e8b57; text-align: center; }
  .container { display: flex; justify-content: center; align-items: flex-start; gap: 30px; flex-wrap: wrap; }
  table { border-collapse: collapse; background: #e8f5e9; border-radius: 8px; }
  th, td { border: 1px solid #c8e6c9; padding: 8px 12px; }
  th { background: #a5d6a7; color: #1b5e20; }
  .tabs { text-align: center; margin: 30px 0; }
  .tab-button { margin: 5px; padding: 10px 15px; border: none; background: #c8e6c9; border-radius: 8px; cursor: pointer; }
  .tab-button.active { background: #81c784; color: white; }
  .gift-table { width: 100%; margin-top: 10px; }
  .gift-table td { border-bottom: 1px solid #ddd; padding: 6px; }
  .gift-form input, .gift-form textarea { margin: 3px; padding: 5px; }
  .gift-form { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 10px; }
  .gift-form textarea { width: 200px; height: 50px; resize: none; }
  .stocking { margin-top: 15px; display: flex; flex-direction: column; align-items: flex-start; }
  .stocking textarea { width: 300px; height: 60px; border-radius: 5px; padding: 5px; }
  button { background: #66bb6a; border: none; color: white; border-radius: 6px; padding: 6px 10px; cursor: pointer; }
  .tree { text-align: center; font-size: 50px; }
</style>
</head>
<body>
<h1>üéÅ West Family Gift Exchange üéÑ</h1>

<div class="container">
  <div>
    <div class="tree">üéÑ</div>
    <table>
      <tr><th colspan="2">Adults</th></tr>
      <tr><td>Jon</td><td>Katie</td></tr>
      <tr><td>Dave</td><td>Jason</td></tr>
      <tr><td>Karen</td><td>Chelsea</td></tr>
      <tr><td>Jen</td><td>Stef</td></tr>
      <tr><td>Dan</td><td>Jon</td></tr>
      <tr><td>Jason</td><td>Dave</td></tr>
      <tr><td>Stef</td><td>Geoff</td></tr>
      <tr><td>Katie</td><td>Dan</td></tr>
      <tr><td>Chelsea</td><td>Jen</td></tr>
      <tr><td>Geoff</td><td>Karen</td></tr>
      <tr><th colspan="2">Kids</th></tr>
      <tr><td>Eddie</td><td>Gwen</td></tr>
      <tr><td>Gwen</td><td>Evie</td></tr>
      <tr><td>Evie</td><td>Claire</td></tr>
      <tr><td>Claire</td><td>Eddie</td></tr>
      <tr><td>Main</td><td>Theo</td></tr>
      <tr><td>Theo</td><td>Elora</td></tr>
      <tr><td>Elora</td><td>Main</td></tr>
      <tr><td>Eden</td><td>Nora</td></tr>
      <tr><td>Nora</td><td>Eden</td></tr>
    </table>
  </div>

  <div style="flex: 1; min-width: 600px;">
    <div class="tabs" id="tabs"></div>
    <div id="giftSection"></div>
  </div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzLLgBhfilqIkTFo-xHoEF7A_9ozy3fU6uAD701FU7u2dfEulbV8vNIde1gt3avHBrLdQ/exec";
const adults = ["Jon","Dave","Karen","Jen","Dan","Jason","Stef","Katie","Chelsea","Geoff"];
const kids = ["Eddie","Gwen","Evie","Claire","Main","Theo","Elora","Eden","Nora"];
let allData = [];
let activeName = adults[0];

async function loadData() {
  const res = await fetch(SCRIPT_URL);
  allData = await res.json();
  renderTabs();
  showGifts(activeName);
}

function renderTabs() {
  const tabContainer = document.getElementById("tabs");
  tabContainer.innerHTML = `
    <div><strong>Adults:</strong><br>${adults.map(n => `<button class="tab-button ${n===activeName?'active':''}" onclick="setActive('${n}')">${n}</button>`).join("")}</div>
    <div style="margin-top:15px;"><strong>Kids:</strong><br>${kids.map(n => `<button class="tab-button ${n===activeName?'active':''}" onclick="setActive('${n}')">${n}</button>`).join("")}</div>
  `;
}

function setActive(name) {
  activeName = name;
  renderTabs();
  showGifts(name);
}

function showGifts(name) {
  const section = document.getElementById("giftSection");
  const gifts = allData.filter(g => g.Name === name && g.GiftName);
  const stocking = allData.find(g => g.Name === name && g.StockingIdea);

  section.innerHTML = `
    <h2>${name}'s Gifts</h2>
    <div class="gift-form">
      <input id="giftName" placeholder="Gift Name">
      <input id="priority" placeholder="Priority" style="width:70px;">
      <input id="price" placeholder="Price" style="width:70px;">
      <input id="url" placeholder="Product URL" style="width:180px;">
      <textarea id="notes" placeholder="Notes"></textarea>
      <button onclick="addGift()">Add Gift</button>
    </div>
    <table class="gift-table">
      <tr><th>Gift</th><th>Priority</th><th>Price</th><th>URL</th><th>Notes</th><th></th></tr>
      ${gifts.map(g => `
        <tr>
          <td>${g.GiftName}</td>
          <td>${g.Priority}</td>
          <td>${g.Price}</td>
          <td>${g.URL ? `<a href="${g.URL.startsWith('http') ? g.URL : 'https://' + g.URL}" target="_blank">Link</a>` : ''}</td>
          <td>${g.Notes}</td>
          <td><button onclick="removeGift('${g.ID}')">‚ùå</button></td>
        </tr>`).join("")}
    </table>

    <div class="stocking">
      <label>üéÖ Stocking Ideas:</label>
      <textarea id="stocking">${stocking ? stocking.StockingIdea : ""}</textarea>
      <button onclick="saveStocking()">Save Stocking Idea</button>
    </div>
  `;
}

async function addGift() {
  const data = {
    action: "addGift",
    name: activeName,
    giftName: document.getElementById("giftName").value,
    priority: document.getElementById("priority").value,
    price: document.getElementById("price").value,
    url: document.getElementById("url").value,
    notes: document.getElementById("notes").value
  };
  await fetch(SCRIPT_URL, { method: "POST", body: JSON.stringify(data) });
  await loadData();
}

async function removeGift(id) {
  await fetch(SCRIPT_URL, { method: "POST", body: JSON.stringify({ action: "removeGift", id }) });
  await loadData();
}

async function saveStocking() {
  const stockingIdea = document.getElementById("stocking").value;
  await fetch(SCRIPT_URL, { method: "POST", body: JSON.stringify({ action: "saveStocking", name: activeName, stockingIdea }) });
}
loadData();
</script>
</body>
</html>
