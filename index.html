<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>West Family Gift Exchange üéÅ</title>
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: #f9fafb;
    text-align: center;
    margin: 0;
    padding: 0;
  }
  h1 {
    color: #146c43;
    margin-top: 20px;
  }
  .tabs {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 20px;
    gap: 10px;
  }
  .tab {
    background: #d1e7dd;
    border: 2px solid #146c43;
    border-radius: 10px;
    padding: 10px 20px;
    cursor: pointer;
    font-weight: 600;
  }
  .tab.active {
    background: #146c43;
    color: white;
  }
  .content {
    margin: 30px auto;
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    max-width: 700px;
    padding: 20px;
    text-align: left;
  }
  .gift-inputs {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 20px;
  }
  input, textarea {
    border: 1px solid #ccc;
    border-radius: 6px;
    padding: 6px;
    flex: 1;
  }
  input[type="number"] {
    width: 80px;
  }
  button {
    background: #146c43;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 8px 14px;
    cursor: pointer;
    font-weight: 600;
  }
  button:hover {
    background: #0f5132;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  th, td {
    padding: 8px;
    border-bottom: 1px solid #e9ecef;
  }
  a {
    color: #0d6efd;
  }
</style>
</head>
<body>
<h1>üéÑ West Family Gift Exchange üéÅ</h1>

<div class="tabs" id="tabs"></div>
<div id="content"></div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbwP_Tbu9_QuDMm6onR0fvri-byDwspixqDClvnTPU2NC1R7SE01pPlORnQoQWKczorsrg/exec";

const people = ["Jon", "Katie", "Dave", "Jason", "Karen", "Chelsea", "Jen", "Stef", "Dan", "Geoff", "Eddie", "Gwen", "Evie", "Claire", "Main", "Theo", "Elora", "Eden", "Nora"];
let data = {};

async function loadData() {
  const res = await fetch(`${scriptURL}?t=${Date.now()}`);
  data = await res.json();
  renderTabs();
}

function renderTabs() {
  const tabContainer = document.getElementById("tabs");
  tabContainer.innerHTML = "";
  people.forEach(p => {
    const tab = document.createElement("div");
    tab.className = "tab";
    tab.textContent = p;
    tab.onclick = () => selectPerson(p);
    tabContainer.appendChild(tab);
  });
  selectPerson(people[0]);
}

function selectPerson(person) {
  document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
  [...document.querySelectorAll(".tab")].find(t => t.textContent === person).classList.add("active");

  const c = document.getElementById("content");
  const pData = data[person] || { gifts: [], stocking: "" };

  c.innerHTML = `
    <div class="gift-inputs">
      <input id="giftName" placeholder="Gift name" />
      <input id="priority" placeholder="Priority" style="width:80px"/>
      <input id="price" type="number" placeholder="Price" style="width:80px"/>
      <input id="url" placeholder="URL" />
      <textarea id="notes" placeholder="Notes" rows="1"></textarea>
      <button onclick="addGift('${person}')">Add Gift</button>
    </div>

    <h3>Gifts for ${person}</h3>
    <table>
      <tr><th>Name</th><th>Priority</th><th>Price</th><th>Notes</th><th>Link</th><th></th></tr>
      ${pData.gifts.map(g => `
        <tr>
          <td>${g.name}</td>
          <td>${g.priority}</td>
          <td>${g.price}</td>
          <td>${g.notes}</td>
          <td>${g.url ? `<a href="${g.url}" target="_blank">Link</a>` : ""}</td>
          <td><button onclick="removeGift('${person}', '${g.name}')">‚ùå</button></td>
        </tr>
      `).join("")}
    </table>

    <h3 style="margin-top:25px;">Stocking Idea</h3>
    <textarea id="stockingIdea" rows="3" style="width:100%;">${pData.stocking || ""}</textarea><br>
    <button onclick="saveStocking('${person}')">Save Stocking Idea</button>
  `;
}

async function addGift(person) {
  const gift = {
    name: document.getElementById("giftName").value.trim(),
    priority: document.getElementById("priority").value.trim(),
    price: document.getElementById("price").value.trim(),
    url: document.getElementById("url").value.trim(),
    notes: document.getElementById("notes").value.trim()
  };
  if (!gift.name) return alert("Please enter a gift name");

  await fetch(scriptURL, {
    method: "POST",
    body: JSON.stringify({ action: "addGift", person, gift })
  });
  loadData();
}

async function removeGift(person, name) {
  await fetch(scriptURL, {
    method: "POST",
    body: JSON.stringify({ action: "removeGift", person, name })
  });
  loadData();
}

async function saveStocking(person) {
  const stocking = document.getElementById("stockingIdea").value.trim();
  await fetch(scriptURL, {
    method: "POST",
    body: JSON.stringify({ action: "saveStocking", person, stocking })
  });
  alert("Stocking idea saved!");
}
loadData();
</script>
</body>
</html>
