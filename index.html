<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Christmas Gift Exchange ðŸŽ„</title>
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      margin: 0;
      display: flex;
      background-color: #f5f7f5;
      color: #333;
    }
    .left-column {
      width: 280px;
      background-color: #e8f5e9;
      padding: 20px;
      border-right: 2px solid #a5d6a7;
      text-align: center;
    }
    .tree {
      font-size: 48px;
      margin-bottom: 10px;
    }
    .group-title {
      font-weight: bold;
      color: #2e7d32;
      font-size: 1.1em;
      margin-top: 20px;
      margin-bottom: 8px;
      text-align: center;
      border-bottom: 1px solid #a5d6a7;
      padding-bottom: 4px;
    }
    .pair-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 10px;
      background-color: #ffffff;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .pair-table th {
      background-color: #c8e6c9;
      color: #2e7d32;
      font-weight: 600;
      text-align: left;
      padding: 6px 8px;
      font-size: 0.9em;
    }
    .pair-table td {
      padding: 6px 10px;
      border-bottom: 1px solid #e0f2f1;
      font-size: 0.9em;
    }
    .pair-table tr:last-child td {
      border-bottom: none;
    }
    .content {
      flex: 1;
      padding: 20px;
    }
    .tabs {
      display: flex;
      flex-wrap: wrap;
      margin-bottom: 15px;
      gap: 5px;
      justify-content: center;
    }
    .tab {
      padding: 8px 14px;
      background-color: #c8e6c9;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.95em;
    }
    .tab.active {
      background-color: #81c784;
      color: white;
      font-weight: 600;
    }
    .tab-content {
      display: none;
      background-color: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 6px rgba(0,0,0,0.1);
    }
    .tab-content.active {
      display: block;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border-bottom: 1px solid #ddd;
      padding: 6px;
      text-align: left;
    }
    th {
      background-color: #e8f5e9;
      color: #2e7d32;
    }
    input, textarea {
      padding: 6px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    input {
      height: 30px;
    }
    textarea {
      width: 100%;
      height: 70px;
      resize: vertical;
      margin-top: 5px;
    }
    .gift-input-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 6px;
    }
    .gift-input-row input {
      flex: 1;
    }
    .gift-input-row button {
      flex-shrink: 0;
    }
    button {
      padding: 6px 10px;
      background-color: #66bb6a;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #57a05b;
    }
    h3 {
      color: #2e7d32;
    }
  </style>
</head>
<body>
  <div class="left-column">
    <div class="tree">ðŸŽ„</div>
    <div class="group-title">Adults</div>
    <table class="pair-table">
      <tr><th>Giver</th><th>â†’ Receiver</th></tr>
      <tr><td>Jon</td><td>Katie</td></tr>
      <tr><td>Dave</td><td>Jason</td></tr>
      <tr><td>Karen</td><td>Chelsea</td></tr>
      <tr><td>Jen</td><td>Stef</td></tr>
      <tr><td>Dan</td><td>Jon</td></tr>
      <tr><td>Jason</td><td>Dave</td></tr>
      <tr><td>Stef</td><td>Geoff</td></tr>
      <tr><td>Katie</td><td>Dan</td></tr>
      <tr><td>Chelsea</td><td>Jen</td></tr>
      <tr><td>Geoff</td><td>Karen</td></tr>
    </table>

    <div class="group-title">Kids</div>
    <table class="pair-table">
      <tr><th>Giver</th><th>â†’ Receiver</th></tr>
      <tr><td>Eddie</td><td>Gwen</td></tr>
      <tr><td>Gwen</td><td>Evie</td></tr>
      <tr><td>Evie</td><td>Claire</td></tr>
      <tr><td>Claire</td><td>Eddie</td></tr>
      <tr><td>Main</td><td>Theo</td></tr>
      <tr><td>Theo</td><td>Elora</td></tr>
      <tr><td>Elora</td><td>Main</td></tr>
      <tr><td>Eden</td><td>Nora</td></tr>
      <tr><td>Nora</td><td>Eden</td></tr>
    </table>
  </div>

  <div class="content">
    <div class="tabs" id="adultTabs"></div>
    <div class="tabs" id="kidTabs"></div>
    <div id="tab-contents"></div>
  </div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbxp7B-f21quwbC-UcqnJTdb1xDzePMHd-GoWWGyMjBpt5ua8XMPswBh-jLSKywkz5gA1g/exec";
    const adults = ["Jon","Dave","Karen","Jen","Dan","Jason","Stef","Katie","Chelsea","Geoff"];
    const kids = ["Eddie","Gwen","Evie","Claire","Main","Theo","Elora","Eden","Nora"];
    const people = [...adults, ...kids];

    const adultTabs = document.getElementById("adultTabs");
    const kidTabs = document.getElementById("kidTabs");
    const tabContents = document.getElementById("tab-contents");

    adults.forEach(p => adultTabs.innerHTML += `<div class="tab" data-person="${p}">${p}</div>`);
    kids.forEach(p => kidTabs.innerHTML += `<div class="tab" data-person="${p}">${p}</div>`);

    people.forEach(person => {
      const div = document.createElement("div");
      div.classList.add("tab-content");
      div.id = `content-${person}`;
      div.innerHTML = `
        <h3>${person}'s Gift List</h3>
        <div class="gift-input-row">
          <input id="giftName-${person}" placeholder="Gift name" />
          <input id="giftPriority-${person}" placeholder="Priority" style="width:80px;" />
          <input id="giftPrice-${person}" placeholder="Price" style="width:80px;" />
          <input id="giftURL-${person}" placeholder="Product URL (optional)" />
          <input id="giftNotes-${person}" placeholder="Notes (optional)" />
          <button onclick="addGift('${person}')">Add Gift</button>
        </div>

        <table id="giftTable-${person}">
          <tr><th>Gift</th><th>Priority</th><th>Price</th><th>Link</th><th>Notes</th><th>Remove</th></tr>
        </table>

        <h3>Stocking Ideas</h3>
        <textarea id="stocking-${person}" placeholder="Add stocking ideas..."></textarea>
        <button onclick="saveStocking('${person}')">Save Stocking Ideas</button>
      `;
      tabContents.appendChild(div);
    });

    document.querySelectorAll(".tab").forEach(tab => {
      tab.addEventListener("click", () => {
        document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
        document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));
        tab.classList.add("active");
        document.getElementById(`content-${tab.dataset.person}`).classList.add("active");
      });
    });

    // Load gifts + stocking ideas from Google Sheet
    async function loadData() {
      try {
        const res = await fetch(scriptURL + "?action=getData");
        const data = await res.json();
        for (const person in data) {
          const info = data[person];
          if (info.gifts) {
            info.gifts.forEach(gift => renderGift(person, gift));
          }
          if (info.stocking) {
            document.getElementById(`stocking-${person}`).value = info.stocking;
          }
        }
      } catch (e) {
        console.error("Error loading data:", e);
      }
    }

    async function addGift(person) {
      const name = document.getElementById(`giftName-${person}`).value.trim();
      const priority = document.getElementById(`giftPriority-${person}`).value.trim();
      const price = document.getElementById(`giftPrice-${person}`).value.trim();
      const url = document.getElementById(`giftURL-${person}`).value.trim();
      const notes = document.getElementById(`giftNotes-${person}`).value.trim();
      if (!name) return alert("Please enter a gift name.");

      const gift = { name, priority, price, url, notes };
      renderGift(person, gift);

      await fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify({ action: "addGift", person, gift }),
      });

      document.getElementById(`giftName-${person}`).value = "";
      document.getElementById(`giftPriority-${person}`).value = "";
      document.getElementById(`giftPrice-${person}`).value = "";
      document.getElementById(`giftURL-${person}`).value = "";
      document.getElementById(`giftNotes-${person}`).value = "";
    }

    function renderGift(person, gift) {
      const table = document.getElementById(`giftTable-${person}`);
      const row = document.createElement("tr");
      const linkHTML = gift.url ? `<a href="${gift.url.startsWith('http') ? gift.url : 'https://' + gift.url}" target="_blank">View</a>` : "";
      row.innerHTML = `
        <td>${gift.name}</td>
        <td>${gift.priority}</td>
        <td>${gift.price}</td>
        <td>${linkHTML}</td>
        <td>${gift.notes || ""}</td>
        <td><button onclick="removeGift(this, '${person}', '${gift.name}')">Remove</button></td>
      `;
      table.appendChild(row);
    }

    async function removeGift(button, person, name) {
      button.closest("tr").remove();
      await fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify({ action: "removeGift", person, name }),
      });
    }

    async function saveStocking(person) {
      const stocking = document.getElementById(`stocking-${person}`).value.trim();
      await fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify({ action: "saveStocking", person, stocking }),
      });
      alert("Stocking ideas saved!");
    }

    loadData();
  </script>
</body>
</html>
