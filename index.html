<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Christmas Gift Exchange üéÅ</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8fff8;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: row;
    }
    .sidebar {
      background: #e8f5e9;
      padding: 20px;
      width: 260px;
      border-right: 3px solid #a5d6a7;
    }
    .sidebar h2 {
      color: #1b5e20;
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #c8e6c9;
      border-radius: 8px;
      overflow: hidden;
    }
    th, td {
      border: 1px solid #a5d6a7;
      padding: 4px 8px;
      text-align: left;
      font-size: 14px;
    }
    th {
      background: #81c784;
      color: white;
    }
    .main {
      flex-grow: 1;
      padding: 20px;
    }
    .tab-container {
      text-align: center;
      margin-bottom: 20px;
    }
    .tab {
      display: inline-block;
      margin: 5px;
      padding: 10px 15px;
      border-radius: 20px;
      background: #a5d6a7;
      cursor: pointer;
      transition: 0.2s;
    }
    .tab:hover {
      background: #81c784;
    }
    .active-tab {
      background: #4caf50;
      color: white;
    }
    .gift-form {
      text-align: center;
      display: none;
    }
    input, textarea {
      margin: 4px;
      padding: 6px;
      width: 160px;
    }
    textarea {
      width: 90%;
      max-width: 500px;
      height: 60px;
    }
    button {
      margin: 5px;
      padding: 8px 15px;
      background: #4caf50;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background: #388e3c;
    }
    .gift-list {
      margin-top: 15px;
      text-align: left;
      width: 90%;
      margin-left: auto;
      margin-right: auto;
    }
    .gift-item {
      background: #f1f8e9;
      padding: 6px;
      margin-bottom: 5px;
      border-radius: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }
    .gift-item span {
      flex: 1;
      padding: 0 5px;
      font-size: 14px;
      word-break: break-word;
    }
    .remove-btn {
      background: #ef5350;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      padding: 4px 8px;
    }
    .remove-btn:hover {
      background: #c62828;
    }
    .group-title {
      text-align: center;
      font-weight: bold;
      color: #2e7d32;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>üéÑ Gift Exchange</h2>
    <div class="group-title">Adults</div>
    <table>
      <tr><th>Giver</th><th>Receiver</th></tr>
      <tr><td>Jon</td><td>Katie</td></tr>
      <tr><td>Dave</td><td>Jason</td></tr>
      <tr><td>Karen</td><td>Chelsea</td></tr>
      <tr><td>Jen</td><td>Stef</td></tr>
      <tr><td>Dan</td><td>Jon</td></tr>
      <tr><td>Jason</td><td>Dave</td></tr>
      <tr><td>Stef</td><td>Geoff</td></tr>
      <tr><td>Katie</td><td>Dan</td></tr>
      <tr><td>Chelsea</td><td>Jen</td></tr>
      <tr><td>Geoff</td><td>Karen</td></tr>
    </table>
    <div class="group-title">Kids</div>
    <table>
      <tr><th>Giver</th><th>Receiver</th></tr>
      <tr><td>Eddie</td><td>Gwen</td></tr>
      <tr><td>Gwen</td><td>Evie</td></tr>
      <tr><td>Evie</td><td>Claire</td></tr>
      <tr><td>Claire</td><td>Eddie</td></tr>
      <tr><td>Main</td><td>Theo</td></tr>
      <tr><td>Theo</td><td>Elora</td></tr>
      <tr><td>Elora</td><td>Main</td></tr>
      <tr><td>Eden</td><td>Nora</td></tr>
      <tr><td>Nora</td><td>Eden</td></tr>
    </table>
  </div>

  <div class="main">
    <div class="tab-container" id="tabContainer"></div>
    <div class="gift-form" id="giftForm">
      <h3 id="activeName"></h3>
      <input id="giftName" placeholder="Gift Name" />
      <input id="priority" placeholder="Priority" />
      <input id="price" placeholder="Price Estimate" />
      <input id="url" placeholder="Product URL" />
      <input id="notes" placeholder="Notes" />
      <button id="addGiftBtn">Add Gift</button>
      <div class="gift-list" id="giftList"></div>
      <h4>Stocking Ideas:</h4>
      <textarea id="stockingIdeas" placeholder="Add stocking ideas..."></textarea><br/>
      <button id="saveStockingBtn">Save Stocking Ideas</button>
    </div>
  </div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbzf9DfWB2z_rrdURDRp0_BvriPaNmKZ77M95PqswqN-gtG8vyOU2ftmAf23dSBXy1n6Gg/exec";
    const people = [
      "Jon","Dave","Karen","Jen","Dan","Jason","Stef","Katie","Chelsea","Geoff",
      "Eddie","Gwen","Evie","Claire","Main","Theo","Elora","Eden","Nora"
    ];

    let activePerson = null;
    let allData = {};

    async function loadData() {
      try {
        const res = await fetch(scriptURL);
        allData = await res.json();
      } catch (e) {
        console.error("Error loading data:", e);
        allData = {};
      }
    }

    async function init() {
      await loadData();
      const container = document.getElementById("tabContainer");
      let html = '<div style="margin-bottom:10px;">';
      people.slice(0, 10).forEach(p => {
        html += `<div class="tab" data-name="${p}">${p}</div>`;
      });
      html += '</div><div>';
      people.slice(10).forEach(p => {
        html += `<div class="tab" data-name="${p}">${p}</div>`;
      });
      html += '</div>';
      container.innerHTML = html;

      document.querySelectorAll(".tab").forEach(tab => {
        tab.addEventListener("click", () => selectPerson(tab.dataset.name));
      });

      document.getElementById("addGiftBtn").addEventListener("click", addGift);
      document.getElementById("saveStockingBtn").addEventListener("click", saveStockingIdeas);
    }

    function selectPerson(name) {
      activePerson = name;
      document.getElementById("giftForm").style.display = "block";
      document.getElementById("activeName").textContent = `${name}'s Gift List`;
      document.querySelectorAll(".tab").forEach(t => t.classList.remove("active-tab"));
      document.querySelector(`.tab[data-name='${name}']`).classList.add("active-tab");
      renderGifts();
      renderStocking();
    }

    function renderGifts() {
      const list = document.getElementById("giftList");
      list.innerHTML = "";
      const gifts = (allData[activePerson] && allData[activePerson].gifts) || [];
      gifts.forEach((g, i) => {
        const row = document.createElement("div");
        row.className = "gift-item";
        row.innerHTML = `
          <span><strong>${g.name}</strong></span>
          <span>${g.priority}</span>
          <span>$${g.price}</span>
          <span><a href="${g.url}" target="_blank">Link</a></span>
          <span>${g.notes}</span>
          <button class="remove-btn" onclick="removeGift(${i})">X</button>
        `;
        list.appendChild(row);
      });
    }

    function renderStocking() {
      const text = (allData[activePerson] && allData[activePerson].stocking) || "";
      document.getElementById("stockingIdeas").value = text;
    }

    async function addGift() {
      if (!activePerson) return;
      const gift = {
        name: document.getElementById("giftName").value,
        priority: document.getElementById("priority").value,
        price: document.getElementById("price").value,
        url: document.getElementById("url").value,
        notes: document.getElementById("notes").value
      };
      await fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify({ action: "addGift", person: activePerson, gift })
      });
      await loadData();
      renderGifts();
      document.querySelectorAll("#giftName, #priority, #price, #url, #notes").forEach(i => i.value = "");
    }

    async function removeGift(index) {
      await fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify({ action: "removeGift", person: activePerson, index })
      });
      await loadData();
      renderGifts();
    }

    async function saveStockingIdeas() {
      const stocking = document.getElementById("stockingIdeas").value;
      await fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify({ action: "saveStocking", person: activePerson, stocking })
      });
      await loadData();
    }

    init();
  </script>
</body>
</html>








